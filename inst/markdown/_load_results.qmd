 
```{r}
#| eval: true
#| output: false
#| echo: false
#| label: load-data-from-R


  require(spsUtil)
  quietly = spsUtil::quiet


  require(MBA)
  require(flextable)
  require(gt)  # table formatting
  require(ggplot2)
  require(data.table) # for speed
  require(lubridate)
  require(stringr) 
  require(janitor)
 
  require(aegis)  # basic helper tools
  require(bio.taxonomy)  # handle species codes
  require(bio.snowcrab)
 

  Capitalize = function(x) {
      s <- strsplit(x, " ")[[1]]
      paste(toupper(substring(s, 1, 1)), substring(s, 2), sep = "", collapse = " ")
  }


  

  # reload these in case of local edits
  if (0) {
    load_bio_environment()
    loadfunctions( "aegis")
    loadfunctions( "bio.snowcrab")  
  
    # to enter debug directly ... 
    params = list(
      year_assessment = 2024,
      year_start = 1999,
      data_loc =  "~/bio.data/bio.snowcrab",
      sens = 1,
      debugging = FALSE,
      model_variation = "logistic_discrete_historical",
      todo = c("fishery_results")
    )

  }

  attach(params)  


  #### params and directories

  p = load.environment( year.assessment=year_assessment )  

  SCD = project.datadirectory("bio.snowcrab")

  media_loc = file.path( data_loc, "media" )
  
  outtabledir = file.path( p$annual.results, "tables" ) 

  # note copied "roadshow figures" temporaily here ... figure creation should be be assimilated TODO
  media_supplementary = file.path( data_loc, "assessments",  year_assessment, "media_supplementary")
  
  dir.create(media_supplementary, showWarnings = FALSE, recursive = TRUE )
  message( "\nFigures from the 'roadshow' need to generated into or be copied into: \n  ", media_supplementary, "\n\n" )


  # mau is variable name in logbook.db() , snowcrab.db() and logbook.db()

  mau = "region"  # generic default
  if (params$sens==1) {
    mau = "region"   # cfanorth, cfasouth, cfa4x
  } else if (params$sens==2) {
    mau = "subarea"  # cfanoth, 23, 24, 4x
  }
 
  for ( k in params$todo ) {
    sn_env = snowcrab_load_key_results_to_memory( 
      p=p, 
      todo=k, 
      mau=mau, 
      debugging=params$debugging, 
      return_as_list=TRUE  
    ) 

    attach(sn_env)
  }

  # invisible( sn_env ) 
  # invisible( list2env(sn_env), parent.frame()) 
  # invisible( list2env(sn_env) ) 




```
